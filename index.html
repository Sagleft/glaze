<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Required meta tags always come first -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.5/css/bootstrap.min.css" integrity="sha384-AysaV+vQoT3kOAXZkl02PThvDr8HYKPZhNT5h/CXfBThSRXQ6jW5DO2ekP5ViFdi" crossorigin="anonymous">
</head>

<body>
    <div class="room"></div>
    <div id="status"></div>
    <script src="https://simplewebrtc.com/latest-v2.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js" integrity="sha384-3ceskX3iaEnIogmQchP8opvBy3Mi7Ce34nWjpBIwVTHfGYWQS9jwHDVRnpKKHJg7" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.3.7/js/tether.min.js" integrity="sha384-XTs3FgkjiBgo8qjEjBk0tGmf3wPrWtA6coPfQDfFEY8AnYJwjalXCiosYRBIBZX8" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.5/js/bootstrap.min.js" integrity="sha384-BLiI7JTZm+JWlgKa0M0kGRpJbF2J8q+qreVrKBC47e3K6BW78kGLrCkeRX6I9RoK" crossorigin="anonymous"></script>
    <script>
        var $ = require('jquery');

        var getUrlParameter = function getUrlParameter(sParam) {
            var sPageURL = decodeURIComponent(window.location.search.substring(1)),
                sURLVariables = sPageURL.split('&'),
                sParameterName,
                i;

            for (i = 0; i < sURLVariables.length; i++) {
                sParameterName = sURLVariables[i].split('=');

                if (sParameterName[0] === sParam) {
                    return sParameterName[1] === undefined ? true : sParameterName[1];
                }
            }
        };

        var room = getUrlParameter('room');
        var nickname = getUrlParameter('nick');
        var count = 0;
        console.log(nickname);
        $('.room').append("<h1>Room Name: " + room + "</h1>");


        var webrtc = new SimpleWebRTC({
            // the id/element dom element that will hold "our" video
            //localVideoEl: '',
            // the id/element dom element that will hold remote videos
            //    remoteVideosEl: '',
            // immediately ask for camera access
            autoRequestMedia: true,
            nick: nickname,
            url: "https://signal-master-qdoymkqwfc.now.sh",
            media: {
                video: false,
                audio: true
            },
            recieveMedia: {
                video: false,
                audio: true
            }
        });

        webrtc.on('readyToCall', function() {
            // you can name it anything
            webrtc.joinRoom(room, function(err, res) {
                console.log(err);
            });
        });

        webrtc.on('createdPeer', function(peer) {
            count += 1;
            var grammar1;
            var grammar2;
            if (count === 1) {
                grammar1 = "is";
                grammar2 = "person";
            } else {
                grammar1 = "are";
                grammar2 = "people"
            }
            $('#status').append("<p>" + peer.id + " Joined!</p>");
            $('#status').append("<p>There " + grammar1 + " " + count + " other " + grammar2 + " in the chat!</p>");

        });

        webrtc.on('videoRemoved', function(videoEl, peer) {
            count -= 1;
            $('#status').append("<p>" + peer.id + " left !</p>");
            $('#status').append("<p>There are " + count + " other people in the chat!</p>");


        });
    </script>
</body>

</html>
